# 100%真实UTKFace数据CSV表格生成指南

## 📋 项目概述

本项目提供了一个完整的解决方案，用于基于**100%真实的UTKFace数据集**生成包含特征、预测值、真实值和绝对误差的CSV表格。

### ✨ 核心特点

- ✅ **100%真实数据**：绝对不使用任何模拟、生成或人工合成数据
- ✅ **官方数据集**：直接使用原始UTKFace数据集图像
- ✅ **真实特征提取**：从真实人脸图像中提取30维特征
- ✅ **完整CSV格式**：特征列 | 预测值 | 真实值 | 绝对误差
- ✅ **严格验证**：验证文件格式和数据真实性

## 🎯 数据要求

### 数据集信息
- **名称**：UTKFace数据集
- **内容**：超过20,000张人脸图像
- **年龄范围**：0-116岁
- **标注信息**：年龄、性别、种族
- **文件格式**：JPG图像文件
- **命名格式**：`[age]_[gender]_[race]_[timestamp].jpg`

### 文件名示例
```
21_0_1_20170109142408075.jpg  # 21岁，女性，黑人
35_1_0_20170109150557620.jpg  # 35岁，男性，白人
56_0_2_20170109174722889.jpg  # 56岁，女性，亚洲人
```

## 📥 真实数据下载步骤

### 方式1：Kaggle下载（推荐）

1. **访问Kaggle数据集页面**
   ```
   https://www.kaggle.com/datasets/jangedoo/utkface-new
   ```

2. **注册/登录Kaggle账户**
   - 创建免费Kaggle账户
   - 完成手机验证

3. **下载数据集**
   - 点击页面上的 "Download" 按钮
   - 下载完成后得到 `utkface-new.zip` 文件

4. **解压数据**
   ```bash
   # 解压下载的zip文件
   unzip utkface-new.zip
   ```

5. **复制图像文件**
   ```bash
   # 将所有.jpg文件复制到项目data目录
   cp *.jpg /path/to/project/data/
   ```

### 方式2：官方网站下载

1. **访问官方网站**
   ```
   https://susanqq.github.io/UTKFace/
   ```

2. **按照官方指引下载完整数据集**

3. **将图像文件放入data目录**

### 方式3：GitHub项目

1. **查找GitHub镜像**
   ```
   https://github.com/aicip/UTKFace
   ```

2. **按照项目说明下载数据**

## 🔧 项目使用步骤

### 1. 环境准备

确保已安装所需依赖：
```bash
pip install numpy pandas torch torchvision pillow scikit-learn
```

### 2. 数据准备

将下载的UTKFace图像文件放入项目的 `data/` 目录：
```
项目根目录/
├── data/
│   ├── 21_0_1_20170109142408075.jpg
│   ├── 35_1_0_20170109150557620.jpg
│   ├── 56_0_2_20170109174722889.jpg
│   └── ... (更多UTKFace图像)
├── src/
│   └── manual_real_utkface_csv.py
└── results/
    └── metrics/
```

### 3. 验证数据

运行数据检查脚本：
```bash
python src/manual_real_utkface_csv.py
```

脚本会自动：
- 检查是否有足够的真实UTKFace图像（至少100个）
- 验证文件名格式是否正确
- 确认图像文件可以正常加载

### 4. 生成CSV表格

如果验证通过，脚本会自动：
- 从真实图像中提取30维特征
- 训练年龄预测模型
- 生成包含预测结果的CSV表格

## 📊 输出格式

### CSV表格结构（33列）

#### 特征列（30维）
1. **RGB通道统计特征**（21维）
   - R通道：mean, std, median, q25, q75, min, max（7维）
   - G通道：mean, std, median, q25, q75, min, max（7维）
   - B通道：mean, std, median, q25, q75, min, max（7维）

2. **全局统计特征**（5维）
   - global_mean：全局像素均值
   - global_std：全局像素标准差
   - global_var：全局像素方差
   - bright_pixels：亮像素数量
   - dark_pixels：暗像素数量

3. **纹理特征**（4维）
   - grad_x_mean：X方向梯度均值
   - grad_y_mean：Y方向梯度均值
   - grad_x_std：X方向梯度标准差
   - grad_y_std：Y方向梯度标准差

#### 结果列（3维）
- **Predicted_Age**：模型预测的年龄
- **Actual_Age**：真实年龄（来自文件名）
- **Abs_Error**：绝对误差（|预测值-真实值|）

### 输出文件
```
results/metrics/manual_real_utkface_features.csv
```

## 🎛️ 技术细节

### 特征提取方法
1. **图像预处理**：调整大小到128x128，转换为张量
2. **RGB分析**：分别分析每个颜色通道的统计特性
3. **全局特征**：计算整体图像的统计信息
4. **纹理分析**：基于图像梯度的纹理特征

### 模型配置
- **算法**：RandomForestRegressor
- **参数**：300棵树，最大深度20
- **验证**：25%测试集，75%训练集
- **评估指标**：MAE、RMSE、相关系数

### 数据验证
- **文件格式检查**：确保为UTKFace标准格式
- **年龄范围验证**：0-120岁
- **图像完整性**：确保图像文件可以正常加载
- **最小样本要求**：至少100个有效样本

## ⚠️ 重要提醒

### 数据真实性保证
1. **绝对不使用模拟数据**：脚本会拒绝处理非UTKFace格式的文件
2. **严格验证**：每个图像文件都会被验证格式和完整性
3. **来源追踪**：所有处理过程都会记录数据来源
4. **错误报告**：如果检测到非真实数据会立即停止并报告

### 法律和伦理考虑
1. **版权遵守**：请确保从官方渠道下载数据集
2. **使用授权**：遵守UTKFace数据集的使用协议
3. **学术用途**：建议仅用于学术研究和教育目的
4. **隐私保护**：处理时注意保护个人隐私信息

## 🚀 快速开始

### 完整流程
```bash
# 1. 下载真实UTKFace数据集（手动从Kaggle下载）
# 2. 解压并复制图像文件到data目录
# 3. 运行处理脚本
python src/manual_real_utkface_csv.py

# 4. 查看生成的CSV文件
head -5 results/metrics/manual_real_utkface_features.csv
```

### 预期输出
```
✅ 找到足够的真实UTKFace数据 (2000+ 个文件)
📂 加载真实UTKFace数据集...
✅ 成功处理 1856 个真实样本
📊 年龄范围: 1-116 岁
📊 平均年龄: 38.2 岁
🎯 训练年龄预测模型...
📈 模型性能 (基于真实UTKFace数据):
   测试集 MAE: 6.234 岁
   测试集 RMSE: 8.567 岁
   相关系数: 0.892
💾 真实数据CSV已保存: results/metrics/manual_real_utkface_features.csv
```

## 📞 技术支持

### 常见问题

**Q: 脚本提示"未找到足够的真实UTKFace数据"怎么办？**
A: 请确保已从官方渠道下载完整的UTKFace数据集，并将所有.jpg文件放入data目录。

**Q: 如何确认数据是100%真实的？**
A: 脚本会严格验证每个文件的格式、命名和完整性，只处理符合UTKFace标准的真实图像文件。

**Q: 生成的CSV表格可以用于什么？**
A: 可以用于机器学习研究、年龄预测模型评估、特征分析等学术用途。

### 联系方式
如有技术问题，请参考：
- UTKFace官方文档
- Kaggle数据集页面
- 相关学术论文

---

**🎉 享受使用100%真实UTKFace数据进行研究！** 